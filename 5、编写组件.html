<html>
<head>
  <title>5、编写组件</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/303788 (zh-CN, DDL); Windows/10.0.10586 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="370"/>
<h1>5、编写组件</h1>

<div>
<span><div>最基础的组件示例：</div><div>注意：组件应该在&lt;a-scene&gt;之前定义</div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&lt;html&gt;</div><div>&lt;head&gt;</div><div>&lt;script src=&quot;foo-component.js&quot;&gt;&lt;/script&gt;</div><div>&lt;/head&gt;</div><div style="margin-left:40px;">&lt;body&gt;</div><div style="margin-left:80px;">&lt;script&gt;</div><div style="margin-left:80px;">// Or inline before the &lt;a-scene&gt;.</div><div style="margin-left:80px;">AFRAME.registerComponent('bar', {</div><div style="margin-left:80px;">// ...</div><div style="margin-left:80px;">});</div><div style="margin-left:80px;">&lt;/script&gt;</div><div style="margin-left:80px;">&lt;a-scene&gt;</div><div style="margin-left:80px;">&lt;/a-scene&gt;</div><div style="margin-left:40px;">&lt;/body&gt;</div><div>&lt;/html&gt;</div></div><div><br/></div><div><b>制作一个 hello-world组件</b></div><div><br/></div><div><span style="color: rgb(71, 101, 130);"><code style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 1.3rem; font-family: &quot;Fira Mono&quot;, &quot;Andale Mono&quot;, Monaco, Courier, monospace;">AFRAME.registerComponent //注册组件</code></span></div><div>当组件的实体使用.init()处理程序时，组件将发送一次消息。</div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>AFRAME.registerComponent('hello-world', {</div><div style="margin-left:40px;">init: function () {</div><div style="margin-left:40px;">console.log('Hello, World!');</div><div style="margin-left:40px;">}</div><div>});</div></div><div><br/></div><div>在HTML中使用组件</div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&lt;a-scene&gt;</div><div>&lt;a-entity hello-world&gt;&lt;/a-entity&gt;</div><div>&lt;/a-scene&gt;</div></div><div><br/></div><div>在js中使用组件</div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>document.querySelector('a-scene').setAttribute('hello-world', '');</div></div><div><br/></div><div><b>制作一个log组件</b></div><div><br/></div><div>使用模式定义属性</div><div>如果我们将组件视为一个函数，那么组件的属性就像它的函数参数。属性具有名称、默认值和属性类型。</div><div>对于我们的日志组件，先定义一个message属性。message属性默认值为Hello，World！</div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>AFRAME.registerComponent('log', {</div><div>schema: {</div><div>message: {type: 'string', default: 'Hello, World!'}</div><div>},</div><div>// ...</div><div>});</div></div><div><br/></div><div>使用来自组件内部的属性数据。</div><div>对于string类型的属性不会做任何处理，我们可以直接通过console.log输出message属性。就像前一个例子吧处理函数写在init()里面。组件的属性值可以通过this.data获取，所以我们获取记录方式是this.data.message！</div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>AFRAME.registerComponent('log', {</div><div>schema: {</div><div>     message: {type: 'string', default: 'Hello, World!'}</div><div>},</div><div>init: function () {</div><div>     console.log(this.data.message);</div><div>}</div><div>});</div><div><br/></div></div><div><br/></div><div>在html里面，可以直接把组件附加到实体，设置属性的语法就像css一样。</div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&lt;a-scene&gt;</div><div>&lt;a-entity log=&quot;message: Hello, Metaverse!&quot;&gt;&lt;/a-entity&gt;</div><div>&lt;/a-scene&gt;</div></div><div><br/></div><div><b>处理属性更新</b></div><div><b><br/></b></div><div>我们将添加一个事件（event）属性</div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>// ...</div><div>schema: {</div><div>event: {type: 'string', default: ''},</div><div>message: {type: 'string', default: 'Hello, World!'},</div><div>},</div><div>// ...</div></div><div><br/></div><div>然后把.init()里面的处理程序移到.update()里面.有时候我们大部分逻辑在.update()里面，所以我们可以初始化和处理更新一次，而不重复代码。</div><div>我们要做的是添加一个事件监听器，在记录消息之前监听事件。</div><div><b><br/></b></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>AFRAME.registerComponent('log', {</div><div style="margin-left:40px;">schema: {</div><div style="margin-left:40px;">     event: {type: 'string', default: ''},</div><div style="margin-left:40px;">     message: {type: 'string', default: 'Hello, World!'}</div><div style="margin-left:40px;">},</div><div style="margin-left:40px;">update: function () {</div><div style="margin-left:40px;">     var data = this.data; // Component property values.</div><div style="margin-left:40px;">     var el = this.el; // Reference to the component's entity.</div><div style="margin-left:40px;">     if (data.event) {</div><div style="margin-left:40px;">     // This will log the `message` when the entity emits the `event`.</div><div style="margin-left:40px;">     el.addEventListener(data.event, function () {</div><div style="margin-left:40px;">     console.log(data.message);</div><div style="margin-left:40px;">     });</div><div style="margin-left:40px;">     } else {</div><div style="margin-left:40px;">     // `event` not specified, just log the message.</div><div style="margin-left:40px;">     console.log(data.message);</div><div style="margin-left:40px;">}</div><div style="margin-left:40px;">}</div><div>});</div></div><div><b><br/></b></div><div>接下来扩充一下，写一个只要事件值变化了，就删除这个监听，然后重新生成新的监听。</div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>AFRAME.registerComponent('log', {</div><div>schema: {</div><div>event: {type: 'string', default: ''},</div><div>message: {type: 'string', default: 'Hello, World!'}</div><div>},</div><div>init: function () {</div><div>var self = this;</div><div>this.eventHandlerFn = function () { console.log(self.data.message); };</div><div>},</div><div>update: function (oldData) {</div><div>var data = this.data;</div><div>var el = this.el;</div><div>// `event` updated. Remove the previous event listener if it exists.</div><div>if (oldData.event &amp;&amp; data.event !== oldData.event) {</div><div>el.removeEventListener(oldData.event, this.eventHandlerFn);</div><div>}</div><div>if (data.event) {</div><div>el.addEventListener(data.event, this.eventHandlerFn);</div><div>} else {</div><div>console.log(data.message);</div><div>}</div><div>}</div><div>});</div></div><div><br/></div><div>添加实体</div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&lt;a-scene&gt;</div><div>&lt;a-entity log=&quot;event: anEvent; message: Hello, Metaverse!&quot;&gt;&lt;/a-entity&gt;</div><div>&lt;/a-scene&gt;</div></div><div><br/></div><div>在控制台 输入</div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>var el = document.querySelector('a-entity');</div><div>el.emit('anEvent');</div><div>// &gt;&gt; &quot;Hello, Metaverse!&quot;</div></div><div><br/></div><div>然后改变event的值</div><div><br/></div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>var el = document.querySelector('a-entity');</div><div>el.setAttribute('log', {event: 'anotherEvent', message: 'Hello, new event!'});</div><div>el.emit('anotherEvent');</div><div>// &gt;&gt; &quot;Hello, new event!&quot;</div></div><div><br/></div><div><b>删除组件 </b> <span style="color: rgb(51, 51, 51); font-family: &quot;Fira Sans&quot;, Helvetica, Arial, sans-serif; font-size: 15.4px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0.77px; -webkit-text-stroke-width: 0px; display: inline !important; float: none;">(i.e., </span><code style="margin: 0px; padding: 0px 0.25ch 0px 0.25ch; box-sizing: border-box; font-size: 13px; font-family: &quot;Fira Mono&quot;, &quot;Andale Mono&quot;, Monaco, Courier, monospace; font-weight: 600; color: rgb(51, 51, 51); font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0.77px; -webkit-text-stroke-width: 0px;">.removeAttribute('log')</code><span style="color: rgb(51, 51, 51); font-family: &quot;Fira Sans&quot;, Helvetica, Arial, sans-serif; font-size: 15.4px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0.77px; -webkit-text-stroke-width: 0px; display: inline !important; float: none;">)</span></div><div><br/></div><div>现在举例说明删除组件时调用函数</div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>AFRAME.registerComponent('log', {</div><div style="margin-left:40px;">schema: {</div><div style="margin-left:40px;">event: {type: 'string', default: ''},</div><div style="margin-left:40px;">message: {type: 'string', default: 'Hello, World!'}</div><div style="margin-left:40px;">},</div><div style="margin-left:40px;">init: function () {</div><div style="margin-left:40px;">var self = this;</div><div style="margin-left:40px;">this.eventHandlerFn = function () { console.log(self.data.message); };</div><div style="margin-left:40px;">},</div><div style="margin-left:40px;">update: function (oldData) {</div><div style="margin-left:40px;">var data = this.data;</div><div style="margin-left:40px;">var el = this.el;</div><div style="margin-left:40px;">if (oldData.event &amp;&amp; data.event !== oldData.event) {</div><div style="margin-left:40px;">el.removeEventListener(oldData.event, this.eventHandlerFn);</div><div style="margin-left:40px;">}</div><div style="margin-left:40px;">if (data.event) {</div><div style="margin-left:40px;">el.addEventListener(data.event, this.eventHandlerFn);</div><div style="margin-left:40px;">} else {</div><div style="margin-left:40px;">console.log(data.message);</div><div style="margin-left:40px;">}</div><div style="margin-left:40px;">},</div><div style="margin-left:40px;">/**</div><div style="margin-left:40px;">* Handle component removal.</div><div style="margin-left:40px;">*/</div><div style="margin-left:40px;">remove: function () {</div><div style="margin-left:40px;">var data = this.data;</div><div style="margin-left:40px;">var el = this.el;</div><div style="margin-left:40px;">// Remove event listener.</div><div style="margin-left:40px;">if (data.event) {</div><div style="margin-left:40px;">el.removeEventListener(data.event, this.eventHandlerFn);</div><div style="margin-left:40px;">}</div><div style="margin-left:40px;">}</div><div>});</div></div><div><br/></div><div><b><span style="margin: 0px; padding: 0px; box-sizing: border-box; color: rgb(233, 105, 0); font-family: &quot;Fira Mono&quot;, &quot;Andale Mono&quot;, Monaco, Courier, monospace; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 248);">multiple</span><span style="color: rgb(82, 82, 82); font-family: &quot;Fira Mono&quot;, &quot;Andale Mono&quot;, Monaco, Courier, monospace; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 248); display: inline !important; float: none;"><b>:</b></span> <b><span style="margin: 0px; padding: 0px; box-sizing: border-box; color: rgb(174, 129, 255); font-family: &quot;Fira Mono&quot;, &quot;Andale Mono&quot;, Monaco, Courier, monospace; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 248);">true //</span></b>允许多种方式调用组件</b></div><div>在组件中设置multiple为true就可以调用多个实例</div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>AFRAME.registerComponent('log', {</div><div style="margin-left:40px;">schema: {</div><div style="margin-left:40px;">event: {type: 'string', default: ''},</div><div style="margin-left:40px;">message: {type: 'string', default: 'Hello, World!'}</div><div style="margin-left:40px;">},</div><div style="margin-left:40px;">multiple: true,</div><div style="margin-left:40px;">// ...</div><div>});</div></div><div>多实例调用语法 <span style="color: rgb(51, 51, 51); font-family: &quot;Fira Mono&quot;, &quot;Andale Mono&quot;, Monaco, Courier, monospace; font-size: 13px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 600; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0.77px; -webkit-text-stroke-width: 0px; display: inline !important; float: none;">&lt;COMPONENTNAME&gt;__&lt;ID&gt; 是这样的，例如：</span></div><div><span style="font-weight: 600;"><span style="font-family: 'Fira Mono', 'Andale Mono', Monaco, Courier, monospace;"><span style="color: rgb(51, 51, 51);"><br/></span></span></span></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&lt;a-scene&gt;</div><div>     &lt;a-entity log__helloworld=&quot;message: Hello, World!&quot;</div><div>               log__metaverse=&quot;message: Hello, Metaverse!&quot;&gt;&lt;/a-entity&gt;</div><div>&lt;/a-scene&gt;</div></div><div><span style="font-weight: 600;"><span style="font-family: 'Fira Mono', 'Andale Mono', Monaco, Courier, monospace;"><span style="color: rgb(51, 51, 51);"><br/></span></span></span></div><div><span style="font-weight: 600;"><span style="font-family: 'Fira Mono', 'Andale Mono', Monaco, Courier, monospace;"><span style="color: rgb(51, 51, 51);">js方法</span></span></span></div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>var el = document.querySelector('a-entity');</div><div>el.setAttribute('log__helloworld', {message: 'Hello, World!'});</div><div>el.setAttribute('log__metaverse', {message: 'Hello, Metaverse!'});</div></div><div><br/></div><div>在组件中我们可以使用this.id和this.attrName区分不同实例。</div><div><br/></div><div><b>一个box组件</b></div><div><br/></div><div>这是一个通过使用three.js组件来了解如何添加3D对象。添加宽、高、深度、颜色等属性。</div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>AFRAME.registerComponent('box', {</div><div>schema: {</div><div>width: {type: 'number', default: 1},</div><div>height: {type: 'number', default: 1},</div><div>depth: {type: 'number', default: 1},</div><div>color: {type: 'color', default: '#AAA'}</div><div>}</div><div>});</div></div><div><br/></div><div>在HTML里面这样调用 </div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&lt;a-scene&gt;</div><div>&lt;a-entity box=&quot;width: 0.5; height: 0.25; depth: 1; color: orange&quot;</div><div>position=&quot;0 0 -5&quot;&gt;&lt;/a-entity&gt;</div><div>&lt;/a-scene&gt;</div></div><div><br/></div><div>创建盒子网格，在init()中设置宽、高、贴图、网格等等。</div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>AFRAME.registerComponent('box', {</div><div style="margin-left:40px;">schema: {</div><div style="margin-left:40px;">width: {type: 'number', default: 1},</div><div style="margin-left:40px;">height: {type: 'number', default: 1},</div><div style="margin-left:40px;">depth: {type: 'number', default: 1},</div><div style="margin-left:40px;">color: {type: 'color', default: '#AAA'}</div><div style="margin-left:40px;">},</div><div style="margin-left:40px;">/**</div><div style="margin-left:40px;">* Initial creation and setting of the mesh.</div><div style="margin-left:40px;">*/</div><div style="margin-left:40px;">init: function () {</div><div style="margin-left:40px;">var data = this.data;</div><div style="margin-left:40px;">var el = this.el;</div><div style="margin-left:40px;">// Create geometry.</div><div style="margin-left:40px;">this.geometry = new THREE.BoxBufferGeometry(data.width, data.height, data.depth);</div><div style="margin-left:40px;">// Create material.</div><div style="margin-left:40px;">this.material = new THREE.MeshStandardMaterial({color: data.color});</div><div style="margin-left:40px;">// Create mesh.</div><div style="margin-left:40px;">this.mesh = new THREE.Mesh(this.geometry, this.material);</div><div style="margin-left:40px;">// Set mesh on entity.</div><div style="margin-left:40px;">el.setObject3D('mesh', this.mesh);</div><div style="margin-left:40px;">}</div><div>});</div></div><div><br/></div><div>然后创建更新函数</div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>AFRAME.registerComponent('box', {</div><div style="margin-left:40px;">schema: {</div><div style="margin-left:80px;">width: {type: 'number', default: 1},</div><div style="margin-left:80px;">height: {type: 'number', default: 1},</div><div style="margin-left:80px;">depth: {type: 'number', default: 1},</div><div style="margin-left:80px;">color: {type: 'color', default: '#AAA'}</div><div style="margin-left:40px;">},</div><div style="margin-left:40px;">init: function () {</div><div style="margin-left:80px;">var data = this.data;</div><div style="margin-left:80px;">var el = this.el;</div><div style="margin-left:80px;">this.geometry = new THREE.BoxBufferGeometry(data.width, data.height, data.depth);</div><div style="margin-left:80px;">this.material = new THREE.MeshStandardMaterial({color: data.color});</div><div style="margin-left:80px;">this.mesh = new THREE.Mesh(this.geometry, this.material);</div><div style="margin-left:80px;">el.setObject3D('mesh', this.mesh);</div><div style="margin-left:40px;">},</div><div style="margin-left:40px;">/**</div><div style="margin-left:40px;">* Update the mesh in response to property updates.</div><div style="margin-left:40px;">*/</div><div style="margin-left:40px;">update: function (oldData) {</div><div style="margin-left:80px;">var data = this.data;</div><div style="margin-left:80px;">var el = this.el;</div><div style="margin-left:80px;">// If `oldData` is empty, then this means we're in the initialization process.</div><div style="margin-left:80px;">// No need to update.</div><div style="margin-left:80px;">if (Object.keys(oldData).length === 0) { return; }</div><div style="margin-left:80px;">// Geometry-related properties changed. Update the geometry.</div><div style="margin-left:80px;">if (data.width !== oldData.width ||</div><div style="margin-left:80px;">data.height !== oldData.height ||</div><div style="margin-left:80px;">data.depth !== oldData.depth) {</div><div style="margin-left:80px;">el.getObject3D('mesh').geometry = new THREE.BoxBufferGeometry(data.width, data.height,</div><div style="margin-left:80px;">data.depth);</div><div style="margin-left:80px;">}</div><div style="margin-left:80px;">// Material-related properties changed. Update the material.</div><div style="margin-left:80px;">if (data.color !== oldData.color) {</div><div style="margin-left:80px;">el.getObject3D('mesh').material.color = data.color;</div><div style="margin-left:80px;">}</div><div style="margin-left:40px;">}</div><div>});</div></div><div><br/></div><div>删除盒子网格</div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>AFRAME.registerComponent('box', {</div><div style="margin-left:40px;">// ...</div><div style="margin-left:40px;">remove: function () {</div><div style="margin-left:40px;">this.el.removeObject3D('mesh');</div><div style="margin-left:40px;">}</div><div>});</div></div><div><br/></div><div><b>创建一个跟随组件</b></div><div>这个组件的功能是，告诉一个实体跟随另一个实体，下面是基本框架</div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>AFRAME.registerComponent('follow', {</div><div style="margin-left:40px;">schema: {</div><div style="margin-left:40px;">target: {type: 'selector'},</div><div style="margin-left:40px;">speed: {type: 'number'}</div><div style="margin-left:40px;">},</div><div style="margin-left:40px;">init: function () {</div><div style="margin-left:40px;">this.directionVec3 = new THREE.Vector3();</div><div style="margin-left:40px;">}</div><div>});</div></div><div><br/></div><div>.tick()//处理程序定义行为</div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>AFRAME.registerComponent('follow', {</div><div style="margin-left:40px;">schema: {</div><div style="margin-left:80px;">target: {type: 'selector'},</div><div style="margin-left:80px;">speed: {type: 'number'}</div><div style="margin-left:40px;">},</div><div style="margin-left:40px;">init: function () {</div><div style="margin-left:40px;">     this.directionVec3 = new THREE.Vector3();</div><div style="margin-left:40px;">},</div><div style="margin-left:40px;">tick: function (time, timeDelta) {</div><div style="margin-left:80px;">var directionVec3 = this.directionVec3;</div><div style="margin-left:80px;">// Grab position vectors (THREE.Vector3) from the entities' three.js objects.</div><div style="margin-left:80px;">var targetPosition = this.data.target.object3D.position;</div><div style="margin-left:80px;">var currentPosition = this.el.object3D.position;</div><div style="margin-left:80px;">// Subtract the vectors to get the direction the entity should head in.</div><div style="margin-left:80px;">directionVec3.copy(targetPosition).sub(currentPosition);</div><div style="margin-left:80px;">// Calculate the distance.</div><div style="margin-left:80px;">var distance = directionVec3.length();</div><div style="margin-left:80px;">// Don't go any closer if a close proximity has been reached.</div><div style="margin-left:80px;">if (distance &lt; 1) { return; }</div><div style="margin-left:80px;">// Scale the direction vector's magnitude down to match the speed.</div><div style="margin-left:80px;">var factor = this.data.speed / distance;</div><div style="margin-left:80px;">['x', 'y', 'z'].forEach(function (axis) {</div><div style="margin-left:80px;">directionVec3[axis] *= factor * (timeDelta / 1000);</div><div style="margin-left:80px;">});</div><div style="margin-left:80px;">// Translate the entity in the direction towards the target.</div><div style="margin-left:80px;">this.el.setAttribute('position', {</div><div style="margin-left:80px;">x: currentPosition.x + directionVec3.x,</div><div style="margin-left:80px;">y: currentPosition.y + directionVec3.y,</div><div style="margin-left:80px;">z: currentPosition.z + directionVec3.z</div><div style="margin-left:80px;">});</div><div style="margin-left:40px;">}</div><div>});</div></div><div><br/></div><div>通过生态系统中的组件学习</div><div><ul style="margin: 15px 0px 15px 1em; padding: 0px 0px 0px 1em; box-sizing: border-box; list-style: disc; color: rgb(51, 51, 51); font-family: &quot;Fira Sans&quot;, Helvetica, Arial, sans-serif; font-size: 15.4px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><li style="margin: 0px; padding: 0px; box-sizing: border-box;"><a href="https://aframe.io/registry/" style="margin: 0px; padding: 0px; box-sizing: border-box; border-bottom: 1px solid rgba(53, 196, 232, 0.14902); color: rgb(20, 151, 184); position: relative; text-decoration: none; transition: 0.05s ease;">A-Frame Registry</a> - Curated community components.</li><li style="margin: 0.35rem 0px 0px; padding: 0px; box-sizing: border-box;"><a href="https://github.com/aframevr/aframe/tree/master/src/components" rel="external" style="margin: 0px; padding: 0px; box-sizing: border-box; border-bottom: 1px solid rgba(53, 196, 232, 0.14902); color: rgb(20, 151, 184); position: relative; text-decoration: none; transition: 0.05s ease;" target="_blank">A-Frame core components</a> - Source code of A-Frame’s standard components.</li><li style="margin: 0.35rem 0px 0px; padding: 0px; box-sizing: border-box;"><a href="https://github.com/aframevr/awesome-aframe#components" rel="external" style="margin: 0px; padding: 0px; box-sizing: border-box; border-bottom: 1px solid rgba(53, 196, 232, 0.14902); color: rgb(20, 151, 184); position: relative; text-decoration: none; transition: 0.05s ease;" target="_blank">awesome-aframe components</a> - Giant list of community components.</li><li style="margin: 0.35rem 0px 0px; padding: 0px; box-sizing: border-box;"><a href="https://github.com/aframevr/a-painter/tree/master/src/components" rel="external" style="margin: 0px; padding: 0px; box-sizing: border-box; border-bottom: 1px solid rgba(53, 196, 232, 0.14902); color: rgb(20, 151, 184); position: relative; text-decoration: none; transition: 0.05s ease;" target="_blank">A-Painter components</a> - Application-specific components for A-Painter.</li></ul></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></span>
</div></body></html> 